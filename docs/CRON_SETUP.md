# –ö—Ä–æ–Ω –∑–∞–¥–∞—á–∏ –¥–ª—è Banister Backend

## ‚úÖ –ß—Ç–æ –≥–æ—Ç–æ–≤–æ

–í—Å–µ —Ç—Ä–∏ –∫—Ä–æ–Ω –∑–∞–¥–∞—á–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã:

1. **–ë—ç–∫–∞–ø –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö** - –µ–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ 00:00
2. **–ë—ç–∫–∞–ø MinIO** - –µ–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ 00:00  
3. **–û—á–∏—Å—Ç–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π** - –µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ –≤ –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ –≤ 00:00

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
cron_tasks/
‚îú‚îÄ‚îÄ __init__.py
‚îú‚îÄ‚îÄ apps.py
‚îú‚îÄ‚îÄ cron.py                    # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∫—Ä–æ–Ω –∑–∞–¥–∞—á
‚îî‚îÄ‚îÄ management/
    ‚îî‚îÄ‚îÄ commands/
        ‚îú‚îÄ‚îÄ __init__.py
        ‚îú‚îÄ‚îÄ backup_database.py    # –ë—ç–∫–∞–ø –ë–î
        ‚îú‚îÄ‚îÄ backup_minio.py       # –ë—ç–∫–∞–ø MinIO
        ‚îî‚îÄ‚îÄ cleanup_notifications.py  # –û—á–∏—Å—Ç–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
```

## üîß –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å

### 1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
```bash
pip install django-crontab google-cloud-storage
```

### 2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Google Cloud Storage
1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ [Google Cloud Console](https://console.cloud.google.com/)
2. –í–∫–ª—é—á–∏—Ç–µ Google Cloud Storage API
3. –°–æ–∑–¥–∞–π—Ç–µ Service Account —Å –ø—Ä–∞–≤–∞–º–∏ "Storage Object Admin"
4. –°–æ–∑–¥–∞–π—Ç–µ bucket `banister-backups` –≤ Google Cloud Storage
5. –°–∫–∞—á–∞–π—Ç–µ JSON –∫–ª—é—á –∏ –ø–æ–º–µ—Å—Ç–∏—Ç–µ –≤ `cron_tasks/banister-backup-1700feef3b7a.json` (—Ñ–∞–π–ª –Ω–µ –±—É–¥–µ—Ç –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏)

### 3. –î–æ–±–∞–≤–∏—Ç—å –≤ .env —Ñ–∞–π–ª
```env
# Google Cloud Storage
GOOGLE_CLOUD_BUCKET_NAME=banister-backups


### 4. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫—Ä–æ–Ω –∑–∞–¥–∞—á–∏
```bash
python manage.py crontab add
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–º–∞–Ω–¥
```bash
# –ë—ç–∫–∞–ø –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
python manage.py backup_database

# –ë—ç–∫–∞–ø MinIO
python manage.py backup_minio

# –û—á–∏—Å—Ç–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (–ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä)
python manage.py cleanup_notifications --dry-run

# –û—á–∏—Å—Ç–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (—Ä–µ–∞–ª—å–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ)
python manage.py cleanup_notifications
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á
```bash
python manage.py crontab show
```

## üìÖ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

| –ó–∞–¥–∞—á–∞ | –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ | Cron –≤—ã—Ä–∞–∂–µ–Ω–∏–µ |
|--------|------------|----------------|
| –ë—ç–∫–∞–ø –ë–î | –ï–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ 00:00 | `0 0 * * *` |
| –ë—ç–∫–∞–ø MinIO | –ï–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ 00:00 | `0 0 * * *` |
| –û—á–∏—Å—Ç–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π | –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ –≤ –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ –≤ 00:00 | `0 0 * * 0` |

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±—ç–∫–∞–ø–æ–≤ –≤ Google Drive

```
banister-backups/
‚îú‚îÄ‚îÄ database_backups/
‚îÇ   ‚îú‚îÄ‚îÄ database_backup_20241201_000000.sql
‚îÇ   ‚îî‚îÄ‚îÄ database_backup_20241202_000000.sql
‚îî‚îÄ‚îÄ minio_backups/
    ‚îú‚îÄ‚îÄ minio_backup_20241201_000000.tar.gz
    ‚îî‚îÄ‚îÄ minio_backup_20241202_000000.tar.gz
```

## üîç –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
```bash
# Django –ª–æ–≥–∏
tail -f debug.log

# –°–∏—Å—Ç–µ–º–Ω—ã–µ –ª–æ–≥–∏ cron (Linux)
tail -f /var/log/cron
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –∞–∫—Ç–∏–≤–Ω—ã—Ö –∫—Ä–æ–Ω –∑–∞–¥–∞—á
crontab -l
```

## üõ†Ô∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫—Ä–æ–Ω –∑–∞–¥–∞—á–∞–º–∏

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫—Ä–æ–Ω –∑–∞–¥–∞—á–∏
python manage.py crontab add

# –ü–æ–∫–∞–∑–∞—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏
python manage.py crontab show

# –£–¥–∞–ª–∏—Ç—å –∫—Ä–æ–Ω –∑–∞–¥–∞—á–∏
python manage.py crontab remove
```

## ‚ö†Ô∏è –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –ü—Ä–æ–±–ª–µ–º–∞: –ö–æ–º–∞–Ω–¥—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã
```bash
python manage.py check
```

### –ü—Ä–æ–±–ª–µ–º–∞: –û—à–∏–±–∫–∏ Google Cloud
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ bucket `banister-backups` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∫–ª—é—á –≤ `cron_tasks/banister-backup-1700feef3b7a.json` –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π (—Ñ–∞–π–ª –Ω–µ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏)


## ‚úÖ –°—Ç–∞—Ç—É—Å –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏

- ‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ `cron_tasks` –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ `INSTALLED_APPS`
- ‚úÖ –ö–æ–º–∞–Ω–¥—ã —Å–æ–∑–¥–∞–Ω—ã –∏ –≥–æ—Ç–æ–≤—ã –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é
- ‚úÖ –ö—Ä–æ–Ω –∑–∞–¥–∞—á–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –≤ `settings.py`
- ‚úÖ –ö–ª—é—á Google Cloud –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –ª–æ–∫–∞–ª—å–Ω–æ (–Ω–µ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏)
- ‚úÖ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ `requirements.txt`

**–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!** 